<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Calculateur de moyennes - FSEG</title>
    <style>
      :root {
        --accent: #003366;
        --card: #fff;
        --bg: #f5f7fa;
      }
      body {
        font-family: Inter, system-ui, Arial, sans-serif;
        background: var(--bg);
        margin: 0;
        padding: 24px;
        color: #112;
      }
      header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 20px;
      }
      h1 {
        font-size: 20px;
        margin: 0;
        color: var(--accent);
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 20px;
      }
      .panel {
        background: var(--card);
        padding: 14px;
        border-radius: 10px;
        box-shadow: 0 6px 18px rgba(15, 25, 40, 0.06);
      }
      .unit {
        margin-bottom: 12px;
      }
      .subject {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #eef3f8;
        margin-bottom: 8px;
      }
      .subject .meta {
        min-width: 260px;
      }
      label {
        display: block;
        font-size: 13px;
        color: #445;
      }
      input[type="number"] {
        width: 70px;
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #d8e2ef;
      }
      select {
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #d8e2ef;
      }
      .small {
        font-size: 12px;
        color: #556;
        margin-top: 6px;
      }
      button {
        background: var(--accent);
        color: #fff;
        border: none;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
      }
      .result-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed #eef3f8;
      }
      .results {
        position: sticky;
        top: 24px;
      }
      footer {
        margin-top: 18px;
        color: #667;
        font-size: 13px;
      }
      .muted {
        color: #668;
      }
      .help {
        font-size: 13px;
        background: #f0f6ff;
        padding: 8px;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      .unit-title {
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 6px;
      }
      .coef {
        font-weight: 700;
        color: #223;
      }
      .note {
        font-weight: 700;
      }
      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .results {
          position: static;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        Calculateur de moyennes — FSEG (barème : Examen 60% / DS 20% / CC 20%)
      </h1>
      <div class="muted">Entrez les notes (0–20). Laisser vide = 0.</div>
    </header>

    <div class="grid">
      <div>
        <div class="panel">
          <div class="help">
            <strong>Règles :</strong>
            <ul>
              <li>
                Pour les matières <em>Mixtes</em> : Note = 0.6×Examen + 0.2×DS +
                0.2×CC
              </li>
              <li>
                Pour les matières en <em>Contrôle Continu (CC)</em> : Note =
                moyenne(DS, CC)
              </li>
            </ul>
          </div>

          <!-- Units and subjects -->
          <div id="units-container">
            <!-- Units are generated by JS -->
          </div>

          <div
            style="
              margin-top: 12px;
              display: flex;
              gap: 10px;
              align-items: center;
            "
          >
            <button id="calcBtn">Calculer</button>
            <button id="resetBtn" style="background: #777">
              Réinitialiser
            </button>
          </div>
        </div>

        <div class="panel" style="margin-top: 12px">
          <details open>
            <summary style="font-weight: 600; margin-bottom: 8px">
              Structure utilisée (modifiable dans le code)
            </summary>
            <pre id="structure" class="small"></pre>
          </details>
          <div class="small" style="margin-top: 8px">
            Les coefficients sont appliqués pour chaque matière au calcul de la
            moyenne d'unité.
          </div>
        </div>
      </div>

      <aside class="results">
        <div class="panel">
          <h3 style="margin-top: 0">Résultats</h3>
          <div id="results-list"></div>
          <div style="margin-top: 10px" class="result-row">
            <div><strong>Moyenne semestre</strong></div>
            <div id="moyenneSem" class="note">—</div>
          </div>
        </div>
        <div class="panel" style="margin-top: 12px">
          <h4>Export</h4>
          <p class="small">its free to use : </p>
          <button id="exportJson">Created by RAYEN BENKHALIFA 1ere LBC (click here to copie )</button>
        </div>
      </aside>
    </div>

    <footer>
      <div>
        Made for you — Modifie les matières / coefficients dans le fichier JS. (MR  RAYEN BENKHALIFA 1ERE LBC ) 
      </div>
    </footer>

    <script>
      /* === Structure des unités & matières ===
   Tu peux modifier/ajouter ici les unités et matières.
   Chaque matière : { id, name, coef, regime } where regime = "mixte" or "cc"
*/
      const structure = [
        {
          unitId: "gestion1",
          title: "Gestion 1",
          unitCoef: 2,
          subjects: [
            {
              id: "cg",
              name: "Comptabilité Générale",
              coef: 1,
              regime: "mixte",
            },
            {
              id: "pg",
              name: "Principes de Gestion",
              coef: 1,
              regime: "mixte",
            },
          ],
        },
        {
          unitId: "soft1",
          title: "Soft Skills et Culture 1",
          unitCoef: 3,
          subjects: [
            {
              id: "bc",
              name: "Business Communication (en anglais)",
              coef: 1,
              regime: "cc",
            },
            { id: "ce", name: "Culture d'entreprise", coef: 1, regime: "cc" },
            { id: "cn", name: "Compétences Numériques", coef: 1, regime: "cc" },
          ],
        },
        {
          unitId: "option",
          title: "Unité Optionnelle",
          unitCoef: 3,
          subjects: [
            { id: "ihm", name: "Développement IHM", coef: 2, regime: "cc" },
            {
              id: "org",
              name: "Organisation de l'Entreprise",
              coef: 1,
              regime: "cc",
            },
          ],
        },
        {
          unitId: "algo1",
          title: "Algorithmiques & Structures de données 1",
          unitCoef: 3,
          subjects: [
            {
              id: "algo",
              name: "Algorithmique et structures de données",
              coef: 3,
              regime: "mixte",
            },
          ],
        },
        {
          unitId: "systemes1",
          title: "Systèmes 1",
          unitCoef: 2,
          subjects: [
            {
              id: "arch",
              name: "Systèmes logiques & architecture des ordinateurs",
              coef: 1,
              regime: "mixte",
            },
            {
              id: "os",
              name: "Systèmes d'exploitation",
              coef: 1,
              regime: "mixte",
            },
          ],
        },
        {
          unitId: "math1",
          title: "Mathématiques 1",
          unitCoef: 2,
          subjects: [
            { id: "math", name: "Math I (Analyse)", coef: 1, regime: "mixte" },
            {
              id: "stat",
              name: "Statistiques et Probabilité",
              coef: 1,
              regime: "mixte",
            },
          ],
        },
      ];

      /* --- Utilitaires --- */
      function clampNote(n) {
        n = Number(n);
        if (isNaN(n)) return 0;
        return Math.max(0, Math.min(20, n));
      }
      function noteMixte(exam, ds, cc) {
        return 0.6 * exam + 0.2 * ds + 0.2 * cc;
      }
      function noteCC(ds, cc) {
        return (ds + cc) / 2;
      }

      /* --- Génération du formulaire --- */
      const container = document.getElementById("units-container");
      structure.forEach((u) => {
        const unitDiv = document.createElement("div");
        unitDiv.className = "unit panel";
        unitDiv.innerHTML = `<div class="unit-title">${u.title} <span class="small"> (Coef unité: ${u.unitCoef})</span></div>`;
        u.subjects.forEach((s) => {
          const sub = document.createElement("div");
          sub.className = "subject";
          sub.innerHTML = `
      <div class="meta">
        <div style="font-weight:600">${s.name} <span class="coef"> (coef ${s.coef})</span></div>
        <div class="small">Régime: <strong>${s.regime}</strong></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <label>Examen<input type="number" min="0" max="20" step="0.25" id="${s.id}_exam"></label>
        <label>DS<input type="number" min="0" max="20" step="0.25" id="${s.id}_ds"></label>
        <label>CC<input type="number" min="0" max="20" step="0.25" id="${s.id}_cc"></label>
      </div>
    `;
          unitDiv.appendChild(sub);
        });
        container.appendChild(unitDiv);
      });

      /* show structure json for transparency */
      document.getElementById("structure").textContent = JSON.stringify(
        structure,
        null,
        2
      );

      /* --- Calcul --- */
      function computeAll() {
        const results = [];
        let totalWeighted = 0;
        let totalUnitCoef = 0;

        structure.forEach((unit) => {
          let unitSum = 0;
          let unitCoefSum = 0;
          let subjectsNotes = [];
          unit.subjects.forEach((sub) => {
            const exam = clampNote(
              document.getElementById(sub.id + "_exam").value
            );
            const ds = clampNote(document.getElementById(sub.id + "_ds").value);
            const cc = clampNote(document.getElementById(sub.id + "_cc").value);
            let note = 0;
            if (sub.regime === "mixte") {
              note = noteMixte(exam, ds, cc);
            } else {
              // contrôle continu
              note = noteCC(ds, cc);
            }
            subjectsNotes.push({
              id: sub.id,
              name: sub.name,
              coef: sub.coef,
              note: note,
            });
            unitSum += note * sub.coef;
            unitCoefSum += sub.coef;
          });
          const unitAverage = unitCoefSum ? unitSum / unitCoefSum : 0;
          results.push({
            unitId: unit.unitId,
            title: unit.title,
            unitAvg: unitAverage,
            unitCoef: unit.unitCoef,
            subjects: subjectsNotes,
          });
          totalWeighted += unitAverage * unit.unitCoef;
          totalUnitCoef += unit.unitCoef;
        });

        const semester = totalUnitCoef ? totalWeighted / totalUnitCoef : 0;
        return { results, semester };
      }

      /* --- Affichage résultats --- */
      function showResults() {
        const { results, semester } = computeAll();
        const out = document.getElementById("results-list");
        out.innerHTML = "";
        results.forEach((r) => {
          const div = document.createElement("div");
          div.innerHTML = `<div style="font-weight:700;margin-bottom:6px">${
            r.title
          } — Moyenne unité: <span class="note">${r.unitAvg.toFixed(
            2
          )}</span> (Coef unité ${r.unitCoef})</div>`;
          r.subjects.forEach((s) => {
            const sdiv = document.createElement("div");
            sdiv.className = "small";
            sdiv.style.display = "flex";
            sdiv.style.justifyContent = "space-between";
            sdiv.style.padding = "4px 0";
            sdiv.innerHTML = `<div>${s.name} (coef ${
              s.coef
            })</div><div>${s.note.toFixed(2)}</div>`;
            div.appendChild(sdiv);
          });
          out.appendChild(div);
        });
        document.getElementById("moyenneSem").textContent = semester.toFixed(2);
      }

      /* Buttons */
      document.getElementById("calcBtn").addEventListener("click", showResults);
      document.getElementById("resetBtn").addEventListener("click", () => {
        structure.forEach((u) =>
          u.subjects.forEach((s) => {
            document.getElementById(s.id + "_exam").value = "";
            document.getElementById(s.id + "_ds").value = "";
            document.getElementById(s.id + "_cc").value = "";
          })
        );
        document.getElementById("results-list").innerHTML = "";
        document.getElementById("moyenneSem").textContent = "—";
      });

      document.getElementById("exportJson").addEventListener("click", () => {
        const data = { inputs: {} };
        structure.forEach((u) =>
          u.subjects.forEach((s) => {
            data.inputs[s.id] = {
              exam: clampNote(document.getElementById(s.id + "_exam").value),
              ds: clampNote(document.getElementById(s.id + "_ds").value),
              cc: clampNote(document.getElementById(s.id + "_cc").value),
            };
          })
        );
        navigator.clipboard
          .writeText(JSON.stringify(data, null, 2))
          .then(() => alert("JSON copié dans le presse-papiers"));
      });

      /* Auto-calc on Enter in inputs */
      document.querySelectorAll("input[type=number]").forEach((inp) => {
        inp.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            showResults();
          }
        });
      });
    </script>
  </body>
</html>
